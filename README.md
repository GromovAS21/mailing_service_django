# Cервис рассылки на Django

Данный сервис являться частью микросервисной архитектуры, которая обеспечивает работу большого проекта в части
уведомлений пользователей на email или в telegram.
___

## 1. Технологии и зависимости

Для работы приложения используются следующие технологии и зависимости:

| Компонент               | Версия |                     
|-------------------------|--------|
| **Python**              | 3.12   |
| **Django**              | 5.2.1  |                                     
| **Psycopg2-binary**     | 2.9.10 |                                                  
| **Python-dotenv**       | 0.9.9  |                                 
| **djangorestframework** | 3.16.0 |                                                 
| **redis**               | 6.1.0  |                                                 
| **celery**              | 5.5.2  |                                
| **requests**            | 2.32.3 |   

---

## 2. Эндпоинт

- `POST api/notify/` — создание уведомления с адресатами и выставлением задержки отправки и отправка на email или через Telegram bot c записью уведомления, получателя и лога об отправке в БД.

  ### Пример тела запроса:
  
  С несколькими адресатами
  ```
  {
  "message": "Example notification",
  "recipient": [123456789, test@example.ru],
  "delay": 0
  }
  ```
  или с одним адресатом

  ```
    {
    "message": "Example notification",
    "recipient": [123456789, test@example.ru],
    "delay": 0
    }
    ```
--- 

## 3. Валидация данных

- Проверка на пустое сообщение (минимальная длина сообщения 1 символ)
- Проверка на корректный email
- Проверка на корректный telegram ID (длина 9-10)
- Поле delay может быть со значениями: 0 - без задержки, 1 - через час, 2 - через день 

---

## Установка и запуск

### 1. Клонирование репозитория
   ```bash
   git clone https://github.com/GromovAS21/mailing_service_django.git
   cd mailing_service_django
   ```
### 2. Установка зависимостей

- Установите зависимости с помощью Poetry и активируйте виртуальное окружение:
    ```bash
    poetry install
    poetry shell
    ```

### 3. Настройка переменных окружения

- Переименуйте файл [.env.sample](.env.sample) в [.env](.env.sample) и заполните все переменные в этом файле.
- Для переменной `TELEGRAM_BOT_TOKEN` необходимо в Телеграм создать телеграм бота через https://t.me/BotFather, после создания полученный токен  вставить в переменную.
x
### 4. Запуск приложения

   - Запуск через Docker (веб-сервис)
       ```bash
       docker-compose up -d --build
       ```
     _Веб-приложение будет доступно по адресу: http://127.0.0.1:8000_

---

## Pre-commit (Для разработки)

В проекте присутствует функция pre-commit, который проверяет код на соответствие стандартам PEP8 состоящие из `isort`,
`black`, `flake8`, `flake8-docstrings`;

### Запуск Pre-commit

```bash
pre-commit install
git add .pre-commit-config.yaml
```

После этого при попытке создания коммита будет запускаться проверка кода и если все проверки проходят, создается коммит.

Для ручной проверки кода необходимо выполнить команду:

```bash
pre-commit run --all-files
```
